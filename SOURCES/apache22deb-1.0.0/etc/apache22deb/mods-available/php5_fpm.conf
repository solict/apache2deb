<IfDefine php5_fpm>
<IfModule fastcgi_module>
#
# Sample configuration to enable support for PHP5 via mod_fastcgi and PHP-FPM.
# It is activated by enabling this pseudo-module and mod_fastcgi
# and then passing the argument php5_fpm to apache at startup.
#
# http://serverfault.com/questions/549965/setting-up-apache-2-2-fastcgi-suexec-php-fpm-on-centos-6
# http://www.server-world.info/en/note?os=CentOS_6&p=httpd&f=25
# http://askubuntu.com/questions/378734/how-to-configure-apache-to-run-php-as-fastcgi-on-ubuntu-12-04-via-terminal
# http://stackoverflow.com/questions/19445686/ubuntu-server-apache-2-4-6-client-denied-by-server-configuration-php-fpm
# http://blog.myprod.net/2010/08/14/apache2-suexec-fastcgi-php-5-3-3-fpm-cache-opcode-apc/
# http://blog.kmp.or.at/2013/06/apache-2-2-on-debian-wheezy-w-php-fpm-fastcgi-apc-and-a-kind-of-suexec/
# http://stackoverflow.com/questions/25932989/apache-fastcgi-php-fpm-suexec-permission-denied-error
# http://gist.github.com/diemuzi/3849349

# To enable privilege separation, don't use mod_suexec "SuexecUserGroup" directive.
# Instead see the PHP manual at http://php.net/manual/en/install.fpm.configuration.php
# The owner will need to match for the php-fpm pool, docroot and CGI wrapper script.
#
# Also, don't use mod_fastcgi "FastCgiWrapper" directive. It is incompatible.
#
# Finally, you will need to add and adapt for your vhost the following:
# - the "FastCgiExternalServer" directive
# - the Alias configuration block
# - the MIME, Actions and Location configuration blocks (optionally)
# Note: Copy and adjust the CGI wrapper script path accordingly.

# don't wrap fastcgi script calls in suexec
FastCgiWrapper Off

# Define which server will receive requests via tcp or socket connection
#FastCgiExternalServer /var/www/cgi-bin/php5-fpm -host 127.0.0.1:9000 -pass-header Authorization
FastCgiExternalServer /var/www/cgi-bin/php5-fpm -socket /var/run/php-fpm/php-fpm.sock -pass-header Authorization

<IfModule mime_module>
# Set MIME and handler for .php scripts
AddType application/x-httpd-php .php
AddHandler php5-fpm .php
</IfModule>

<IfModule actions_module>
# Use php5-fpm to process .php scripts
Action php5-fpm /php5-fpm
</IfModule>

<IfModule alias_module>
# Create a alias for the wrapper (file can not exist!)
Alias /php5-fpm "/var/www/cgi-bin/php5-fpm"
</IfModule>

# Setup the wrapper access and options
<Location "/php5-fpm">
    # Don't allow direct execution
    Order Deny,Allow
    Deny from All
    Allow from env=REDIRECT_STATUS
    # Enable CGI support
    Options ExecCGI
</Location>

</IfModule>
</IfDefine>
